<!doctype html><html lang="zh-Hant"><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>Mifare 1k EML 工具</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/animate.css@4/animate.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="Mifare 1k EML 工具" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="Mifare 1k EML 工具" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/pn532.js/m1-eml-toolkit.html" property="og:url"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}.letter-spacing-n1px{letter-spacing:-1px}</style></head><body><div class="container my-3 text-monospace" id="app" v-cloak><h3 class="mb-3 text-center">Mifare 1k EML 工具</h3><div class="form-group"><label>選擇 PN532 的連線方式</label><select class="form-control form-control-sm" v-model="h.adapter"><option value="ble">透過藍芽 BLE 連線 (支援 PC 及 Android)</option><option value="usb">透過 USB 連線 (支援 PC)</option></select></div><div class="form-group"><label class="mb-1 letter-spacing-n1px">Chinese Magic Card gen1a (UID)</label><div class="mx-n1 row"><div class="col px-1"><button @click="btnReadGen1a" class="btn btn-block btn-success" type="button">讀取資料</button></div><div class="col px-1"><button @click="btnVerifyGen1a" class="btn btn-block btn-primary" type="button">比對資料</button></div><div class="col px-1"><button @click="btnWriteGen1a" class="btn btn-block btn-danger" type="button">寫入資料</button></div></div></div><div class="form-group"><label class="mb-1 letter-spacing-n1px">Mifare Classic 1k and Chinese Magic Card gen2 (CUID, FUID, UFUID)</label><div class="mx-n1 row"><div class="col px-1"><button @click="btnReadGen2" class="btn btn-block btn-success" type="button">讀取資料</button></div><div class="col px-1"><button @click="btnVerifyGen2" class="btn btn-block btn-primary" type="button">比對資料</button></div><div class="col px-1"><button @click="btnWriteGen2" class="btn btn-block btn-danger" type="button">寫入資料</button></div></div></div><div class="form-group"><label class="mb-1">Common</label><button @click="btnEditEml" class="btn btn-block mt-1 btn-primary">編輯卡片資料</button><button @click="btnEditMfkeys" class="btn btn-block mt-1 btn-info">編輯卡片金鑰</button><button @click="btnLoadKeysFromEml" class="btn btn-block mt-1 btn-outline-dark">從卡片資料提取金鑰</button><button @click="btnSetBlankEml" class="btn btn-block mt-1 btn-outline-warning">重設為空白卡片資料</button></div><div class="fade modal" data-backdrop="static" data-keyboard="false" ref="exportimport" tabindex="-1"><div class="align-items-stretch modal-dialog modal-dialog-centered modal-xl"><div class="modal-content"><div class="d-flex flex-column modal-body"><textarea class="form-control form-control-sm flex-fill" v-model="exportimport.text"></textarea><small class="form-text text-muted">請點下方「複製」按鈕複製資料，或貼上新資料並點下方「匯入」按鈕。</small></div><div class="modal-footer"><button @click="btnCopy(exportimport.text, $refs.exportimport)" class="btn btn-outline-success" type="button">複製</button><button @click="exportimport?.cb?.()" class="btn btn-secondary" type="button">取消</button><button @click="exportimport?.cb?.(exportimport.text)" class="btn btn-primary" type="button">匯入</button></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/pn532.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/Crypto1.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/Hf14a.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/LoggerRxTx.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/WebbleAdapter.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/WebserialAdapter.min.js" crossorigin="anonymous"></script><script>const{Pn532:{Pn532,Packet,utils:Pn532utils},Pn532Hf14a,Pn532LoggerRxTx,Pn532WebbleAdapter,Pn532WebserialAdapter}=window,pn532usb=new Pn532,pn532ble=(pn532usb.use(new Pn532WebserialAdapter),pn532usb.use(new Pn532Hf14a),new Pn532);pn532ble.use(new Pn532WebbleAdapter),pn532ble.use(new Pn532Hf14a),new URL(location).searchParams.has("debug")&&(pn532usb.use(new Pn532LoggerRxTx),pn532ble.use(new Pn532LoggerRxTx)),window.vm=new Vue({el:"#app",data:{exportimport:{text:"",cb:null},h:{adapter:"ble",eml:"",mfkeys:""}},async mounted(){try{var e=JSON5.parse(localStorage.getItem(location.pathname));e&&this.$set(this,"h",{...this.h,...e})}catch(e){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0})},computed:{pn532(){return"usb"===this.h.adapter?pn532usb:pn532ble},card(){try{var e=Packet.fromHex(this.h.eml);if(Packet.isLen(e,1024))return e;throw new TypeError("invalid M1 card")}catch(e){return null}},cardKeys(){var t=[];if(!this.card)return t;for(let e=0;e<16;e++)t.push(this.card.subarray(64*e+48,64*e+54)),t.push(this.card.subarray(64*e+58,64*e+64));return this.pn532.$hf14a.mfKeysUniq(t)},keys(){var e=Packet.fromHex(this.h.mfkeys);return e.length%6?null:this.pn532.$hf14a.mfKeysUniq(e.chunk(6))}},methods:{async btnReadGen1a(){try{this.showLoading("請稍候","正在讀取 UID 卡");var e,{data:t,success:a}=await this.pn532.$hf14a.mfReadCardGen1a();if(this.setCard(t),64!==_.sum(a))return e=_.filter(_.map(a,(e,t)=>[t,null][e]),_.isInteger),await Swal.fire({icon:"error",title:e.length+" 個 block 讀取失敗",text:"失敗的 block: "+e.join()});await Swal.fire({icon:"success",title:"讀取成功"}),await this.btnEditEml()}catch(e){console.error(e),await Swal.fire({icon:"error",title:"讀取失敗",text:e.message})}},async btnVerifyGen1a(){try{this.showLoading("請稍候","正在讀取 UID 卡");var e,{data:t,success:a}=await this.pn532.$hf14a.mfReadCardGen1a();if(64!==_.sum(a))return e=_.filter(_.map(a,(e,t)=>[t,null][e]),_.isInteger),await Swal.fire({icon:"error",title:e.length+" 個 block 讀取失敗",text:"失敗的 block: "+e.join()});if(console.log({card:this.card,other:t}),!t.isEqual(this.card))throw new Error("卡片資料不同");await Swal.fire({icon:"success",title:"卡片資料相同"})}catch(e){console.error(e),await Swal.fire({icon:"error",title:"比對失敗",text:e.message})}},async btnWriteGen1a(){try{if(!Packet.isLen(this.card,1024))throw new TypeError("EML 資料有誤");if(await this.confirm("即將覆蓋 UID 卡資料，是否繼續？","繼續","取消")){this.showLoading("請稍候","正在寫入 UID 卡");var e,t=(await this.pn532.$hf14a.mfWriteCardGen1a({data:this.card}))["success"];if(64!==_.sum(t))return e=_.filter(_.map(t,(e,t)=>[t,null][e]),_.isInteger),await Swal.fire({icon:"error",title:e.length+" 個 block 寫入失敗",text:"失敗的 block: "+e.join()});await Swal.fire({icon:"success",title:"寫入成功"})}}catch(e){console.error(e),await Swal.fire({icon:"error",title:"寫入失敗",text:e.message})}},async btnReadGen2(){try{this.showLoading("請稍候","正在讀取 CUID 卡");var e,{success:{read:t},data:a}=await this.pn532.$hf14a.mfReadCardByKeys({keys:this.keys});if(this.setCard(a),64!==_.sum(t))return e=_.filter(_.map(t,(e,t)=>[t,null][e]),_.isInteger),await Swal.fire({icon:"error",title:e.length+" 個 block 讀取失敗",text:"失敗的 block: "+e.join()});await Swal.fire({icon:"success",title:"讀取成功"}),await this.btnEditEml()}catch(e){console.error(e),await Swal.fire({icon:"error",title:"讀取失敗",text:e.message})}},async btnVerifyGen2(){try{this.showLoading("請稍候","正在讀取 CUID 卡");var e,{data:t,success:{read:a}}=await this.pn532.$hf14a.mfReadCardByKeys({keys:this.keys});if(64!==_.sum(a))return e=_.filter(_.map(a,(e,t)=>[t,null][e]),_.isInteger),await Swal.fire({icon:"error",title:e.length+" 個 block 讀取失敗",text:"失敗的 block: "+e.join()});if(console.log({card:this.card,other:t}),!t.isEqual(this.card))throw new Error("卡片資料不同");await Swal.fire({icon:"success",title:"卡片資料相同"})}catch(e){console.error(e),await Swal.fire({icon:"error",title:"比對失敗",text:e.message})}},async btnWriteGen2(){try{if(!this.card)throw new TypeError("EML 資料有誤");if(await this.confirm("即將覆蓋 CUID 卡資料，是否繼續？","繼續","取消")){this.showLoading("請稍候","正在寫入 CUID 卡");var e,t=(await this.pn532.$hf14a.mfWriteCardByKeys({keys:this.keys,data:this.card}))["success"];if(64!==_.sum(t))return e=_.filter(_.map(t,(e,t)=>[t,null][e]),_.isInteger),await Swal.fire({icon:"error",title:e.length+" 個 block 寫入失敗",text:"失敗的 block: "+e.join()});await Swal.fire({icon:"success",title:"寫入成功"})}}catch(e){console.error(e),await Swal.fire({icon:"error",title:"寫入失敗",text:e.message})}},async btnLoadKeysFromEml(){try{this.setKeys([...this.cardKeys,...Packet.fromHex("FFFFFFFFFFFF 000000000000 A0A1A2A3A4A5 D3F7D3F7D3F7").chunk(6)]),await Swal.fire({icon:"success",title:"提取成功",text:`總共提取了 ${this.keys.length} 筆金鑰`})}catch(e){console.error(e),await Swal.fire({icon:"error",title:"發生錯誤",text:e.message})}},async btnSetBlankEml(){if(await this.confirm("即將設定成空白 EML，是否繼續？","繼續","取消")){var t=new Packet(1024),a=(t.set(Packet.fromHex("0102030404080400000000000000BEAF"),0),Packet.fromHex("FFFFFFFFFFFF08778F00FFFFFFFFFFFF"));for(let e=0;e<16;e++)t.set(a,64*e+48);this.setCard(t)}},async btnEditEml(){const t=window.jQuery(this.$refs.exportimport);var e=await new Promise(e=>{this.$set(this,"exportimport",{cb:e,text:this.h.eml}),t.one("hide.bs.modal",()=>e()).modal("show")});_.isNil(e)||this.$set(this.h,"eml",e),t.modal("hide"),this.$set(this.exportimport,"cb",null)},async btnEditMfkeys(){const t=window.jQuery(this.$refs.exportimport);var e=await new Promise(e=>{this.$set(this,"exportimport",{cb:e,text:this.h.mfkeys}),t.one("hide.bs.modal",()=>e()).modal("show")});_.isNil(e)||this.$set(this.h,"mfkeys",e),t.modal("hide"),this.$set(this.exportimport,"cb",null)},setCard(e){if(!Packet.isLen(e,1024))throw new TypeError("invalid card");this.$set(this.h,"eml",_.map(e.chunk(16),"hex").join("\n"))},setKeys(e){e=_.map(this.pn532.$hf14a.mfKeysUniq(e),"hex").join("\n"),this.$set(this.h,"mfkeys",e)},async btnCopy(e,t=null){t=t||document.body;var a=document.createElement("textarea");a.value=e,t.appendChild(a),a.select(),a.setSelectionRange(0,1e6),document.execCommand("copy"),t.removeChild(a),await Swal.fire({icon:"success",title:"複製成功"})},async confirm(e,t,a){return(await Swal.fire({cancelButtonColor:"#3085d6",cancelButtonText:a,confirmButtonColor:"#d33",confirmButtonText:t,focusCancel:!0,icon:"warning",showCancelButton:!0,text:e}))?.isConfirmed},showLoading(e,t){Swal.fire({title:e,text:t,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})}}});</script></body></html>