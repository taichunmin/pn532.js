<!doctype html><html lang="zh-Hant"><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>Mifare 卡號拷貝工具</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/animate.css@4/animate.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="Mifare 卡號拷貝工具" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="Mifare 卡號拷貝工具" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/pn532.js/m1-uid4b-writer.html" property="og:url"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}li.nav-item>button.nav-link{color:#007bff;background-color:transparent}.input-group-prepend .input-group-text{letter-spacing:-1px;min-width:80px}.shield{display:-ms-inline-flexbox;display:inline-flex;font-size:75%;letter-spacing:-.5px;line-height:1;position:relative;vertical-align:middle;white-space:nowrap}.shield .shield-name,.shield .shield-value{padding:.25em .4em}.shield .shield-name{align-items:center;border-bottom-left-radius:.25rem;border-top-left-radius:.25rem;display:-ms-inline-flexbox;display:inline-flex}.shield .shield-value{border-bottom-right-radius:.25rem;border-top-right-radius:.25rem;border:1px solid #ccc;border-left:0}.bg-00A98F{background-color:#00a98f}.bg-B02CCE{background-color:#b02cce}.bg-004680{background-color:#004680}</style></head><body><div class="container my-3 text-monospace" id="app" v-cloak><h2 class="mb-3 text-center">Mifare 卡號拷貝工具</h2><div class="card my-2"><div class="card-header"><ul class="card-header-tabs nav nav-tabs"><li class="nav-item"><button class="btn-sm nav-link" type="button" @click="h.page = 'writeCard'" :class="{active: (h.page === 'writeCard')}"><i class="fa fa-fw fa-id-card-o"></i> 寫卡</button></li><li class="nav-item"><button class="btn-sm nav-link" type="button" @click="h.page = 'setting'" :class="{active: (h.page === 'setting')}"><i class="fa fa-fw fa-cogs"></i> 設定</button></li></ul></div><div class="card-body pb-3" v-if="h.page === 'writeCard'"><h5 class="mb-2 card-title">拷貝卡號到 UID/CUID 卡片</h5><small class="text-muted">本工具可以控制 PN532 硬體來寫入 UID/CUID 卡片的區塊 0，如果您的門禁系統只驗證卡號，就可以透過本工具來拷貝。 目前僅支援在 Windows、Ubuntu、macOS 或 Android 8 以上的 Chrome 中使用，需要自備硬體。</small><hr><div class="mb-2 form-group"><label>選擇 PN532 的連線方式</label><select class="form-control form-control-sm" v-model="h.adapter"><option value="ble">透過藍芽 BLE 連線 (支援 PC 及 Android)</option><option value="usb">透過 USB Serial 連線 (支援 PC)</option></select></div><div class="mb-2 form-group was-validated"><label>卡片資料</label><div class="mb-2 input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">UID</span></div><input class="form-control" v-model="h.card.uid" pattern="[\dA-Fa-f]{8}" required><div class="input-group-append"><button class="btn btn-outline-danger" type="button" @click="h.card.uid = ''">清空</button></div></div><div class="mb-2 input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">SAK</span></div><input class="form-control" v-model="h.card.sak" pattern="[\dA-Fa-f]{2}" required><div class="input-group-append"><button class="btn btn-outline-danger" type="button" @click="h.card.sak = ''">清空</button></div></div><div class="mb-2 input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">ATQA</span></div><input class="form-control" v-model="h.card.atqa" pattern="[\dA-Fa-f]{4}" required><div class="input-group-append"><button class="btn btn-outline-danger" type="button" @click="h.card.atqa = ''">清空</button></div></div><small class="text-muted form-text" v-if="cardName">此卡片已儲存為「<code>{{ cardName }}</code>」。</small><small class="text-muted form-text" v-else>此卡片尚未儲存。</small></div><div class="mt-2 mx-n1 row"><div class="col px-1"><button class="btn btn-block btn-success" type="button" @click="btnReadCard"><i class="fa fa-fw fa-sign-out"></i> 讀取卡片</button></div><div class="col px-1"><button class="btn btn-block btn-primary" type="button" @click="btnSetUid"><i class="fa fa-fw fa-sign-in"></i> 寫入卡片</button></div></div><hr><h5 class="mb-2 card-title">已儲存 <code>{{ this.cards.length }}</code> 張卡片</h5><small class="text-muted">您可以點下方的「儲存卡片」來儲存卡片資料，或點下方的「選擇卡片」來選擇之前儲存的卡片。</small><div class="mt-2 mx-n1 row"><div class="col px-1"><button class="btn btn-block btn-success" type="button" @click="btnSaveCard"><i class="fa fa-fw fa-download"></i> 儲存卡片</button></div><div class="col px-1"><button class="btn btn-block btn-primary" type="button" @click="btnPickCard" :disabled="!h.cards.length"><i class="fa fa-fw fa-upload"></i> 選擇卡片</button></div></div></div><template v-if="h.page === 'setting'"><div class="card-body"><div class="mb-2 card-title align-items-center d-flex"><h5 class="mb-0">卡片清單 (CSV)</h5><span class="badge badge-pill badge-primary ml-2">{{ this.cards.length }}</span></div><small class="text-muted">在此提供您以 CSV 格式編輯已儲存的卡片清單，如果匯入的資料格式有誤，現有的卡片清單會保持不變。</small><button class="btn btn-block mt-2 btn-info" type="button" @click="btnEditCardsCsv"><i class="fa mr-2 fa-code"></i> 匯出匯入</button></div><div class="card-body border-top"><div class="mb-2 card-title align-items-center d-flex"><h5 class="mb-0">CUID 卡片金鑰</h5><span class="badge badge-pill badge-primary ml-2">{{ this.mfkeys.length }}</span></div><small class="text-muted">雖然 CUID 卡片可以修改 Block 0，但仍需要有金鑰以及相對應的 Sector 權限才能寫入，你可以在此編輯 CUID 卡片的金鑰，每行一個金鑰，每個金鑰是由長度 12 的十六進位數字所組成。</small><button class="btn btn-block mt-2 btn-info" type="button" @click="btnEditMfkeys"><i class="fa mr-2 fa-code"></i> 匯出匯入</button></div><div class="card-body border-top"><h5 class="mb-2 card-title">重設資料</h5><small class="text-muted">本工具的資料是存在瀏覽器內的 <code>localStorage</code>，如果想要將資料重設，請點選下方按鈕。（此動作無法還原）</small><button class="btn btn-block mt-2 btn-outline-danger" type="button" @click="btnReset"><i class="fa mr-2 fa-repeat"></i> 重設資料</button></div></template></div><div class="fade modal" data-keyboard="false" ref="cardPicker" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-xl"><div class="modal-content"><div class="modal-header"><div class="d-flex align-items-center modal-title w-100"><div class="flex-fill"><div class="input-group"><div class="input-group-prepend"><span class="input-group-text">模糊搜尋</span></div><input class="form-control" v-model="cardPicker.keyword" id="h-keyword" placeholder="模糊搜尋: 名稱、UID"><div class="input-group-append"><button class="btn btn-outline-danger" type="button" @click="cardPicker.keyword = ''">清空</button></div></div></div><button class="close" type="button" data-dismiss="modal"><span>×</span></button></div></div><div class="modal-body p-0"><ul class="list-group list-group-flush"><button class="d-flex flex-column list-group-item list-group-item-action" type="button" @click="cardPicker?.cb?.(c)" :class="[cmpCard(cardPicker?.cur, c) ? 'list-group-item-secondary' : '']" :key="`${c.uid}${c.sak}${c.atqa}`" v-for="c of sortedCards"><h5 class="my-1">{{ c.name }}</h5><div class="d-flex flex-wrap mx-n1"><div class="mb-1 mx-1 shield"><div class="shield-name text-white bg-00A98F">UID</div><div class="bg-white shield-value text-dark">{{ c.uid }}</div></div><div class="mb-1 mx-1 shield"><div class="shield-name text-white bg-B02CCE">SAK</div><div class="bg-white shield-value text-dark">{{ c.sak }}</div></div><div class="mb-1 mx-1 shield"><div class="shield-name text-white bg-004680">ATQA</div><div class="bg-white shield-value text-dark">{{ c.atqa }}</div></div></div></button></ul></div></div></div></div><div class="fade modal" data-keyboard="false" ref="exportimport" tabindex="-1" data-backdrop="static"><div class="modal-dialog modal-dialog-centered modal-xl align-items-stretch"><div class="modal-content"><div class="d-flex flex-column modal-body"><textarea class="form-control form-control-sm flex-fill" v-model="exportimport.text"></textarea><small class="text-muted form-text">請點下方「複製」按鈕複製資料，或貼上新資料並點下方「匯入」按鈕。</small></div><div class="modal-footer"><button class="btn btn-outline-success" type="button" @click="btnCopy(exportimport.text, $refs.exportimport)">複製</button><button class="btn btn-secondary" type="button" @click="exportimport?.cb?.()">取消</button><button class="btn btn-primary" type="button" @click="exportimport?.cb?.(exportimport.text)">匯入</button></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/pn532.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/Crypto1.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/Hf14a.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/LoggerRxTx.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/WebbleAdapter.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/pn532.js/plugin/WebserialAdapter.min.js" crossorigin="anonymous"></script><script>const{Pn532:{Pn532,Packet,utils:Pn532utils},Pn532Hf14a,Pn532LoggerRxTx,Pn532WebbleAdapter,Pn532WebserialAdapter}=window,pn532usb=new Pn532,pn532ble=(pn532usb.use(new Pn532WebserialAdapter),pn532usb.use(new Pn532Hf14a),new Pn532),cmpCard=(pn532ble.use(new Pn532WebbleAdapter),pn532ble.use(new Pn532Hf14a),new URL(location).searchParams.has("debug")&&(pn532usb.use(new Pn532LoggerRxTx),pn532ble.use(new Pn532LoggerRxTx)),(t,e)=>_.toUpper(t?.uid)===_.toUpper(e?.uid)&&_.toUpper(t?.atqa)===_.toUpper(e?.atqa)&&_.toUpper(t?.sak)===_.toUpper(e?.sak)),validateCard=t=>{if(!/^[\dA-Fa-f]{4}$/.test(t.atqa))throw new TypeError("ATQA 有誤");if(!/^[\dA-Fa-f]{2}$/.test(t.sak))throw new TypeError("SAK 有誤");if(/^[\dA-Fa-f]{8}$/.test(t.uid))return{..._.mapValues(_.pick(t,["uid","sak","atqa"]),_.toUpper),name:t.name??t.uid};throw new TypeError("UID 有誤")},countChar=(()=>{const e=_.toArray(" ()-./~、（）");return t=>_.omit(_.countBy(_.toLower(t)),e)})(),lcs=(a,r)=>{if(!(_.isString(a)&&_.isString(r)&&a.length&&r.length))return 0;const t={};[a,r]=_.chain([" "+a," "+r]).orderBy(["length"],["desc"]).value(),t.len=r.length,t.lcs=_.times(2,()=>_.times(t.len,()=>0));for(let e=1;e<a.length;e++){var[s,i]=[t.lcs[1&e],t.lcs[1-(1&e)]];for(let t=1;t<r.length;t++)s[t]=a[e]===r[t]?i[t-1]+1:Math.max(i[t],s[t-1])}return t.lcs[1-(1&a.length)][t.len-1]};window.vm=new Vue({el:"#app",data:{cardPicker:{keyword:"",cur:null,cb:null},exportimport:{text:"",cb:null},h:{adapter:"ble",card:{atqa:"0004",name:"",sak:"08",uid:""},cards:[],mfkeys:"FFFFFFFFFFFF\n000000000000\nA0A1A2A3A4A5\nD3F7D3F7D3F7",page:"writeCard"}},async mounted(){try{var t=JSON5.parse(localStorage.getItem(location.pathname));t&&this.$set(this,"h",{...this.h,...t})}catch(t){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0}),await this.init()},computed:{pn532(){return"usb"===this.h.adapter?pn532usb:pn532ble},cardName(){return _.find(this.h.cards,t=>cmpCard(this.h.card,t))?.name},cards(){return _.chain(this.h.cards??[]).map(t=>{var e=_.toLower(""+t.name+t.uid);return{...t,fulltext:e,countChar:countChar(e)}}).orderBy(["name","uid"],["asc","asc"]).value()},sortedCards(){const e=_.toLower(_.trim(this.cardPicker.keyword??""));if(!e)return this.cards;const t=_.toPairs(countChar(e));return _.orderBy(this.cards,[a=>_.sumBy(t,([t,e])=>_.clamp(a.countChar[t]??0,e)),t=>lcs(e,t.fulltext)],["desc","desc"])},mfkeys(){var t=Packet.fromHex(this.h.mfkeys).chunk(6);return this.pn532.$hf14a.mfKeysUniq(t)}},methods:{async init(){},async btnReadCard(){try{this.showLoading("正在讀卡...","若耗時過久請重新整理網頁。");var t=_.chain(await this.pn532.$hf14a.mfSelectCard()).pick(["uid","sak","atqa"]).mapValues("hex").value();this.$set(this.h,"card",t),Swal.close()}catch(t){console.error(t),await Swal.fire({icon:"error",title:"讀卡失敗",text:t.message})}},async btnSetUid(){try{validateCard(this.h.card),this.showLoading("正在寫卡...","若耗時過久請重新整理網頁。");var t=_.mapValues(_.pick(this.h.card,["uid","sak","atqa"]),t=>Packet.fromHex(t));const e=[];if(await this.pn532.$hf14a.mfSetUidGen1a(t).catch(t=>e.push(t)),e.length&&await this.pn532.$hf14a.mfSetUidGen2({...t,keys:this.mfkeys}).catch(t=>e.push(t)),2===e.length)throw new Error(`UID: ${e[0]?.message}, CUID: `+e[1]?.message);if(!(await this.pn532.$hf14a.mfSelectCard()).uid.isEqual(t.uid))throw new Error("複驗時卡號不符");await Swal.fire({icon:"success",title:"寫卡成功"})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"寫卡失敗",text:t.message})}},async btnSaveCard(){try{var t=validateCard(JSON.parse(JSON.stringify(this.h.card)));t.name=(await Swal.fire({input:"text",inputValidator:t=>t?.length?null:"卡片名稱不能為空",inputValue:this.cardName??t.uid,reverseButtons:!0,showCancelButton:!0,title:"請輸入卡片名稱"}))?.value,t.name&&this.$set(this.h,"cards",_.uniqWith([t,...this.h.cards],cmpCard))}catch(t){console.error(t),await Swal.fire({icon:"error",title:"卡片儲存失敗",text:t.message})}},async btnPickCard(){const e=window.jQuery(this.$refs.cardPicker);var t=await new Promise(t=>{this.$set(this,"cardPicker",{cb:t,cur:JSON.parse(JSON.stringify(this.h.card))}),e.one("hide.bs.modal",()=>t()).modal("show")});e.modal("hide"),t&&this.$set(this.h,"card",t),this.$set(this.cardPicker,"cb",null)},async btnEditMfkeys(){const e=window.jQuery(this.$refs.exportimport);var t=await new Promise(t=>{this.$set(this,"exportimport",{cb:t,text:this.h.mfkeys}),e.one("hide.bs.modal",()=>t()).modal("show")});_.isNil(t)||this.$set(this.h,"mfkeys",t),e.modal("hide"),this.$set(this.exportimport,"cb",null)},async btnEditCardsCsv(){const e=window.jQuery(this.$refs.exportimport);let a=await new Promise(t=>{this.$set(this,"exportimport",{cb:t,text:_.chain(this.h.cards).map(t=>_.pick(t,["uid","sak","atqa","name"])).orderBy(["name","uid"],["asc","asc"]).thru(t=>Papa.unparse(t,{header:!0})).value()}),e.one("hide.bs.modal",()=>t()).modal("show")});for(;!_.isNil(a);)try{var r=Papa.parse(a,{encoding:"utf8",header:!0})?.data??[];for(let e=0;e<r.length;e++)try{r[e]=validateCard(r[e])}catch(t){throw t.message=t.message+", "+JSON5.stringify(r[e]),t}this.$set(this.h,"cards",r);break}catch(t){console.error(t),await Swal.fire({icon:"error",title:"匯入失敗",text:t.message}),a=await new Promise(t=>{this.$set(this.exportimport,"cb",t)})}e.modal("hide"),this.$set(this.exportimport,"cb",null)},async btnReset(){if(await this.confirm("是否重設資料？（此動作無法還原）","確定","取消"))return this.showLoading("刪除資料中...","刪除後將自動重新整理網頁。"),localStorage.removeItem(location.pathname),location.reload(),new Promise(t=>{})},async btnCopy(t,e=null){e=e||document.body;var a=document.createElement("textarea");a.value=t,e.appendChild(a),a.select(),a.setSelectionRange(0,1e6),document.execCommand("copy"),e.removeChild(a),await Swal.fire({icon:"success",title:"複製成功"})},async confirm(t,e,a){return(await Swal.fire({cancelButtonColor:"#3085d6",cancelButtonText:a,confirmButtonColor:"#d33",confirmButtonText:e,focusCancel:!0,icon:"warning",showCancelButton:!0,text:t}))?.isConfirmed},showLoading(t,e){Swal.fire({title:t,text:e,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})}}});</script></body></html>